<!-- AYAS-7 Menu s animovanou zelenou kostkou -->
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: #eef2f5;
  }

  #header {
    text-align: center;
    color: #003063;
    font-size: 2em;
    font-weight: bold;
    padding: 20px 0;
  }

  nav {
    background-color: #003063;
    padding: 10px 0;
  }

  nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    gap: 15px;
  }

  nav li {
    position: relative;
    font-weight: bold;
  }

  nav li a {
    text-decoration: none;
    color: white;
    padding: 10px 15px;
    display: block;
    transition: color 0.3s;
    position: relative;
    z-index: 1;
  }

  /* Animovaná zelená kostka */
  nav li::after {
    content: '';
    position: absolute;
    left: 50%;
    bottom: 0;
    transform: translateX(-50%) scaleY(0);
    width: 100%;
    height: 6px;
    background-color: #1da84f;
    border-radius: 3px;
    transition: transform 0.3s ease;
    pointer-events: none;
    transform-origin: bottom;
  }

  nav li:hover::after {
    transform: translateX(-50%) scaleY(1);
  }

  nav li:hover a {
    color: #1da84f;
  }

  nav li:last-child a {
    color: #1da84f;
  }
</style>

<div id="header">AYAS-7 Engine</div>

<nav>
  <ul>
    <li><a href="token-layer.html">AGS</a></li>
    <li><a href="liquidity-engine.html">TVL</a></li>
    <li><a href="yield-routing.html">LRE</a></li>
    <li><a href="risk-compliance.html">RIC</a></li>
    <li><a href="fintech-interaction.html">YRO</a></li>
    <li><a href="core-engine.html">RMC</a></li>
    <li><a href="dashboard-analytics.html">FIA</a></li>
    <li><a href="https://winwin.coop/#ww-onb" target="_blank" rel="noopener noreferrer">Win-Win</a></li>
  </ul>
</nav>
<!-- Konec menu -->

<!DOCTYPE html>
<html lang="cs">
<head>
 <meta charset="UTF-8" />
 <title>AYAS-7 Engine Dashboard</title>
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 
 <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

 <style>
   :root {
     --bg-page: #eef2f5;
     --bg-box: #ffffff;
     --blue-dark: #003063;
     --blue-mid: #1f5fbf;
     --blue-light: #66b0ff;
     --green: #1da84f;
     --text-main: #1f2933;
     --text-muted: #6b7280;
     --border-soft: rgba(0,0,0,0.06);
   }

   * {
     box-sizing: border-box;
   }

   #msg_body {
     margin: 0;
     padding: 0;
     background: var(--bg-page);
     font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
     color: var(--text-main);
   }

   /* Hlavní container */
   #ayas-dashboard {
     max-width: 1200px;
     margin: 20px auto 40px auto;
     padding: 0 10px 20px 10px;
   }

   .page-title {
     margin: 10px 0 20px 0;
     font-size: 24px;
     font-weight: 600;
     color: var(--blue-dark);
     display: flex;
     align-items: center;
     gap: 8px;
   }

   .page-title-dot {
     width: 14px;
     height: 14px;
     background: var(--green);
     border-radius: 4px;
   }

   .columns {
     display: flex;
     gap: 24px;
     align-items: flex-start;
     justify-content: center;
     flex-wrap: wrap;
   }

   .col {
     display: flex;
     flex-direction: column;
     gap: 16px;
     align-items: flex-start;
     flex: 1;
     min-width: 0;
   }

   .layer-box,
   .rbox {
     width: 100%;
     max-width: 500px;
     background: var(--bg-box);
     border-radius: 10px;
     box-shadow: 0 4px 12px rgba(15,23,42,0.08);
     padding: 16px 18px;
   }

   .layer-box {
     min-height: 300px; /* zvětšené boxy pro graf + text */
     display: flex;
     flex-direction: column;
     justify-content: space-between;
   }

   .layer-header {
     display: flex;
     align-items: center;
     gap: 12px;
     margin-bottom: 8px;
   }

   .layer-header img {
     width: 56px;
     height: 56px;
     border-radius: 8px;
     object-fit: contain;
     flex-shrink: 0;
   }

   .layer-title {
     font-size: 16px;
     font-weight: 600;
     margin-bottom: 2px;
   }

   .layer-desc {
     font-size: 13px;
     color: var(--text-muted);
   }

   .color-strip {
     width: 4px;
     border-radius: 4px;
     align-self: stretch;
     margin-right: 8px;
   }

   .layer-header-wrap {
     display: flex;
     align-items: stretch;
   }

   .token-row {
     display: flex;
     gap: 10px;
     margin: 8px 0 10px 0;
     flex-wrap: wrap;
   }

   .token-pill {
     flex: 1;
     min-width: 120px;
     background: #f3f4f6;
     border-radius: 10px;
     padding: 6px 8px;
     display: flex;
     align-items: center;
     justify-content: space-between;
     color: #ffffff;
   }

   .token-pill.usdtz {
     background: var(--green);
   }

   .token-pill.gusd {
     background: var(--blue-mid);
   }

   .token-label {
     font-size: 13px;
   }

   .token-value {
     font-size: 13px;
     font-weight: 600;
   }

   .layer-chart {
     width: 100%;
     height: 140px;
   }

   /* Pravé boxy */
   .rbox-title {
     font-size: 16px;
     font-weight: 600;
     margin: 0 0 10px 0;
     display: flex;
     align-items: center;
     gap: 8px;
     color: var(--blue-dark);
   }

   .rbox-title-dot {
     width: 10px;
     height: 10px;
     border-radius: 50%;
     background: var(--blue-light);
   }

   .rbox p {
     margin: 4px 0;
     font-size: 13px;
     color: var(--text-muted);
   }

   .form-group {
     margin-bottom: 10px;
   }

   .form-group label {
     font-size: 13px;
     display: block;
     margin-bottom: 3px;
   }

   .form-group input,
   .form-group select {
     width: 100%;
     padding: 7px 8px;
     border-radius: 6px;
     border: 1px solid var(--border-soft);
     font-family: inherit;
     font-size: 13px;
   }

   .btn {
     padding: 8px 16px;
     border-radius: 6px;
     border: none;
     cursor: pointer;
     font-size: 13px;
     font-family: inherit;
     display: inline-flex;
     align-items: center;
     justify-content: center;
     gap: 6px;
   }

   .btn-primary {
     background: var(--blue-dark);
     color: #ffffff;
   }

   .btn-secondary {
     background: var(--blue-mid);
     color: #ffffff;
   }

   .btn-ghost {
     background: #f3f4f6;
     color: var(--blue-dark);
   }

   .small-muted {
     font-size: 12px;
     color: var(--text-muted);
   }

   .result-box {
     margin-top: 10px;
     padding: 8px 10px;
     background: #e5f3ff;
     border-radius: 6px;
     font-size: 13px;
   }

   /* Terms box */
   .terms-row {
     display: flex;
     align-items: center;
     gap: 10px;
     margin-top: 8px;
     flex-wrap: wrap;
   }

   /* Kurzy */
   .rates-row {
     display: grid;
     grid-template-columns: repeat(2, minmax(0,1fr));
     gap: 8px;
     margin-top: 8px;
   }

   .rate-card {
     background: #f9fafb;
     border-radius: 8px;
     padding: 8px;
     font-size: 12px;
   }

   .rate-label {
     font-weight: 600;
     margin-bottom: 2px;
   }

   .rate-value {
     font-size: 13px;
   }

   /* DEX odkazy */
   .dex-links {
     display: flex;
     flex-direction: column;
     gap: 6px;
     margin-top: 8px;
   }

   .dex-link {
     font-size: 12px;
     color: var(--blue-mid);
     text-decoration: none;
   }

   .dex-link:hover {
     text-decoration: underline;
   }

   /* Modální okno pro podmínky */
   .modal-backdrop {
     display: none;
     position: fixed;
     inset: 0;
     background: rgba(15,23,42,0.4);
     z-index: 1000;
     align-items: center;
     justify-content: center;
     padding: 20px;
   }

   .modal {
     background: #ffffff;
     border-radius: 10px;
     max-width: 600px;
     width: 100%;
     max-height: 80vh;
     overflow-y: auto;
     padding: 16px 18px 20px 18px;
     box-shadow: 0 12px 30px rgba(15,23,42,0.3);
   }

   .modal-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: 10px;
   }

   .modal-header h3 {
     margin: 0;
     font-size: 16px;
   }

   .modal-close {
     border: none;
     background: transparent;
     font-size: 20px;
     cursor: pointer;
     line-height: 1;
   }

   .modal p {
     font-size: 13px;
     color: var(--text-main);
   }

   /* Graf pro výnos družstva */
   #coopYieldChart {
     width: 100%;
     height: 220px;
   }

   /* Footer */
   footer {
     margin-top: 24px;
     font-size: 12px;
     color: var(--text-muted);
     text-align: center;
   }

   /* Responsivita */
   @media (max-width: 900px) {
     .columns {
       flex-direction: column;
       align-items: center;
     }
     .layer-box,
     .rbox {
       max-width: 100%;
     }
   }
 </style>
</head>
<body>

<div id="ayas-dashboard">
 <div class="page-title">
   <div class="page-title-dot"></div>
   AYAS-7 Výkonný motor & členská sekce
 </div>

 <div class="columns">
   
   <div class="col" id="left-col">

     
     <div class="layer-box">
       <div class="layer-header-wrap">
         <div class="color-strip" style="background:#1da84f;"></div>
         <div class="layer-header">
           <img src="assets/1.png" alt="Layer 1" />
           <div>
             <div class="layer-title">Layer 1: Token Layer</div>
             <div class="layer-desc">Správa a distribuce tokenů USDt.z a GUSD pro celý ekosystém.</div>
           </div>
         </div>
       </div>
       <div class="token-row">
         <div class="token-pill usdtz">
           <div class="token-label">USDt.z výnos</div>
           <div class="token-value" id="usd-1">+4.2 %</div>
         </div>
         <div class="token-pill gusd">
           <div class="token-label">GUSD rezerva</div>
           <div class="token-value" id="gusd-1">+2.1 %</div>
         </div>
       </div>
       <canvas id="layerChart-1" class="layer-chart"></canvas>
     </div>

     
     <div class="layer-box">
       <div class="layer-header-wrap">
         <div class="color-strip" style="background:#e11d48;"></div>
         <div class="layer-header">
           <img src="assets/2.png" alt="Layer 2" />
           <div>
             <div class="layer-title">Layer 2: Liquidity Engine</div>
             <div class="layer-desc">Řízení likvidity, LP pozic a rebalancování pro stabilní TVL.</div>
           </div>
         </div>
       </div>
       <div class="token-row">
         <div class="token-pill usdtz">
           <div class="token-label">USDt.z výnos</div>
           <div class="token-value" id="usd-2">+4.5 %</div>
         </div>
         <div class="token-pill gusd">
           <div class="token-label">GUSD rezerva</div>
           <div class="token-value" id="gusd-2">+2.2 %</div>
         </div>
       </div>
       <canvas id="layerChart-2" class="layer-chart"></canvas>
     </div>

     
     <div class="layer-box">
       <div class="layer-header-wrap">
         <div class="color-strip" style="background:#7c3aed;"></div>
         <div class="layer-header">
           <img src="assets/3.png" alt="Layer 3" />
           <div>
             <div class="layer-title">Layer 3: Yield Routing</div>
             <div class="layer-desc">Směrování kapitálu do strategií s nejlepším risk-reward poměrem.</div>
           </div>
         </div>
       </div>
       <div class="token-row">
         <div class="token-pill usdtz">
           <div class="token-label">USDt.z výnos</div>
           <div class="token-value" id="usd-3">+4.8 %</div>
         </div>
         <div class="token-pill gusd">
           <div class="token-label">GUSD rezerva</div>
           <div class="token-value" id="gusd-3">+2.4 %</div>
         </div>
       </div>
       <canvas id="layerChart-3" class="layer-chart"></canvas>
     </div>

     
     <div class="layer-box">
       <div class="layer-header-wrap">
         <div class="color-strip" style="background:#facc15;"></div>
         <div class="layer-header">
           <img src="assets/4.png" alt="Layer 4" />
           <div>
             <div class="layer-title">Layer 4: Risk & Compliance</div>
             <div class="layer-desc">Kontrola limitů, auditní stopa a řízení rizikového profilu.</div>
           </div>
         </div>
       </div>
       <div class="token-row">
         <div class="token-pill usdtz">
           <div class="token-label">USDt.z výnos</div>
           <div class="token-value" id="usd-4">+4.0 %</div>
         </div>
         <div class="token-pill gusd">
           <div class="token-label">GUSD rezerva</div>
           <div class="token-value" id="gusd-4">+2.0 %</div>
         </div>
       </div>
       <canvas id="layerChart-4" class="layer-chart"></canvas>
     </div>

     
     <div class="layer-box">
       <div class="layer-header-wrap">
         <div class="color-strip" style="background:#f97316;"></div>
         <div class="layer-header">
           <img src="assets/5.png" alt="Layer 5" />
           <div>
             <div class="layer-title">Layer 5: FinTech Interaction</div>
             <div class="layer-desc">Rozhraní pro členy, reporting a napojení na finanční partnery.</div>
           </div>
         </div>
       </div>
       <div class="token-row">
         <div class="token-pill usdtz">
           <div class="token-label">USDt.z výnos</div>
           <div class="token-value" id="usd-5">+4.3 %</div>
         </div>
         <div class="token-pill gusd">
           <div class="token-label">GUSD rezerva</div>
           <div class="token-value" id="gusd-5">+2.3 %</div>
         </div>
       </div>
       <canvas id="layerChart-5" class="layer-chart"></canvas>
     </div>

     
     <div class="layer-box">
       <div class="layer-header-wrap">
         <div class="color-strip" style="background:#6b7280;"></div>
         <div class="layer-header">
           <img src="assets/6.png" alt="Layer 6" />
           <div>
             <div class="layer-title">Layer 6: Core Engine</div>
             <div class="layer-desc">Výpočetní jádro – algoritmy, párování, monitorování výkonu.</div>
           </div>
         </div>
       </div>
       <div class="token-row">
         <div class="token-pill usdtz">
           <div class="token-label">USDt.z výnos</div>
           <div class="token-value" id="usd-6">+4.6 %</div>
         </div>
         <div class="token-pill gusd">
           <div class="token-label">GUSD rezerva</div>
           <div class="token-value" id="gusd-6">+2.5 %</div>
         </div>
       </div>
       <canvas id="layerChart-6" class="layer-chart"></canvas>
     </div>

     
     <div class="layer-box">
       <div class="layer-header-wrap">
         <div class="color-strip" style="background:#0ea5e9;"></div>
         <div class="layer-header">
           <img src="assets/7.png" alt="Layer 7" />
           <div>
             <div class="layer-title">Layer 7: Dashboard & Analytics</div>
             <div class="layer-desc">Konsolidovaný přehled, KPI a analytika výkonnosti motoru.</div>
           </div>
         </div>
       </div>
       <div class="token-row">
         <div class="token-pill usdtz">
           <div class="token-label">USDt.z výnos</div>
           <div class="token-value" id="usd-7">+4.9 %</div>
         </div>
         <div class="token-pill gusd">
           <div class="token-label">GUSD rezerva</div>
           <div class="token-value" id="gusd-7">+2.7 %</div>
         </div>
       </div>
       <canvas id="layerChart-7" class="layer-chart"></canvas>
     </div>

   </div>

   
   <div class="col" id="right-col">

     
     <div class="rbox" id="box-member">
       <h3 class="rbox-title">
         <span class="rbox-title-dot"></span>
         Přidání nového člena
       </h3>
       <p class="small-muted">Vyplň základní údaje člena a částku, kterou chce investovat.</p>

       <form id="memberForm">
         <div class="form-group">
           <label for="memberName">Jméno a příjmení</label>
           <input type="text" id="memberName" required />
         </div>
         <div class="form-group">
           <label for="memberEmail">E-mail</label>
           <input type="email" id="memberEmail" required />
         </div>
         <div class="form-group">
           <label for="memberPhone">Telefon</label>
           <input type="text" id="memberPhone" required />
         </div>
         <div class="form-group">
           <label for="investmentAmount">Investovaná částka (CZK)</label>
           <input type="number" id="investmentAmount" min="0" step="100" required />
         </div>
         <button type="submit" class="btn btn-primary">Přidat člena</button>
       </form>

       <div id="memberResult" class="result-box" style="display:none;">
         <div>Počet WW-KEY: <span id="wwKeyCount"></span></div>
         <div>Ekvivalent USDT: <span id="wwUsdtAmount"></span></div>
       </div>
     </div>

     
     <div class="rbox" id="box-terms">
       <h3 class="rbox-title">
         <span class="rbox-title-dot"></span>
         Podmínky služeb Win-Win
       </h3>
       <p class="small-muted">Přečti si podmínky služby a potvrď souhlas před aktivací účtu.</p>

       <div class="terms-row">
         <button class="btn btn-secondary" id="btnShowTerms">Zobrazit podmínky</button>
         <label class="small-muted">
           <input type="checkbox" id="chkAgreeTerms" />
           Souhlasím s podmínkami Win-Win
         </label>
       </div>
     </div>

     
     <div class="rbox" id="box-payment">
       <h3 class="rbox-title">
         <span class="rbox-title-dot"></span>
         Způsob platby
       </h3>
       <p class="small-muted">Člen si může vybrat mezi fiat a krypto platbou. WW-KEY se přidělí podle aktuálního kurzu.</p>

       <p><b>Fiat platba:</b></p>
       <button class="btn btn-secondary" onclick="window.open('payment.html','_blank')">
         Platba bankovním převodem / kartou
       </button>

       <p style="margin-top:10px;"><b>Krypto platba:</b></p>
       <div style="display:flex; flex-wrap:wrap; gap:8px;">
         <button class="btn btn-ghost" onclick="window.open('https://metamask.io','_blank')">Stáhnout MetaMask</button>
         <button class="btn btn-ghost" onclick="window.open('https://pancakeswap.finance','_blank')">Přejít na PancakeSwap</button>
       </div>
       <p class="small-muted" style="margin-top:8px;">Podporované měny: USDt, BNB, TRX, USDt.z (přepočet na WW-KEY dle USD).</p>
     </div>

     
     <div class="rbox" id="box-rates">
       <h3 class="rbox-title">
         <span class="rbox-title-dot"></span>
         Živé kurzy měn
       </h3>
       <p class="small-muted">Automatická aktualizace každých 10 vteřin (USDT a BNB v USD).</p>

       <div class="rates-row">
         <div class="rate-card">
           <div class="rate-label">USDT</div>
           <div class="rate-value" id="rate-usdt">Načítám…</div>
         </div>
         <div class="rate-card">
           <div class="rate-label">BNB</div>
           <div class="rate-value" id="rate-bnb">Načítám…</div>
         </div>
       </div>
     </div>

     
     <div class="rbox" id="box-yield">
       <h3 class="rbox-title">
         <span class="rbox-title-dot"></span>
         Výnos družstva Win-Win
       </h3>
       <p class="small-muted">Sloupcový graf ukazuje zhodnocení jednotlivých vrstev AYAS-7.</p>
       <canvas id="coopYieldChart"></canvas>
     </div>

     
     <div class="rbox" id="box-report">
       <h3 class="rbox-title">
         <span class="rbox-title-dot"></span>
         Denní report & audit
       </h3>
       <p class="small-muted">Rychlý souhrn pro audit – přehled členů, objemu vkladů a přidělených WW-KEY.</p>
       <div class="result-box" id="dailyReportBox">
         <div>Počet nových členů dnes: <span id="report-newMembers">0</span></div>
         <div>Celkový vklad (CZK): <span id="report-totalDeposit">0</span></div>
         <div>Celkem přiděleno WW-KEY: <span id="report-totalWWKey">0</span></div>
       </div>
     </div>

     
     <div class="rbox" id="box-dex">
       <h3 class="rbox-title">
         <span class="rbox-title-dot"></span>
         DEX – živé páry USDt.z &amp; GUSD
       </h3>
       <p class="small-muted">Odkazy na živé pooly na BSC. Lze zobrazit detailní orderflow a likviditu.</p>

       <div class="dex-links">
         <a class="dex-link" href="https://www.geckoterminal.com/bsc/pools/0xa55ccb41096aacf28eaa15efe00ea01b3e773cdd" target="_blank">
           Pool USDt.z – GeckoTerminal
         </a>
         <a class="dex-link" href="https://www.geckoterminal.com/bsc/pools/0xb7c6f12c7232bc6ea895d24447be8d0dbc3438ed" target="_blank">
           Pool GUSD – GeckoTerminal
         </a>
       </div>
       <p class="small-muted">Pro více detailů otevři terminál v novém okně.</p>
     </div>

   </div>
 </div>

 <footer>© 2025 Win-Win Cooperative • AYAS-7 Engine</footer>
</div>


<div class="modal-backdrop" id="termsModalBackdrop">
 <div class="modal">
   <div class="modal-header">
     <h3>Podmínky služby Win-Win</h3>
     <button class="modal-close" id="btnCloseTerms">&times;</button>
   </div>
   <p>
     Zde bude plný text podmínek Win-Win. Můžeš sem vložit obsah z tvé stránky
     <code>terka.html</code> nebo jej nahradit reálnými obchodními podmínkami.
   </p>
   <p class="small-muted">
     Uživatel musí podmínky přečíst a odsouhlasit v pravém boxu, aby mohl být plně aktivní.
   </p>
 </div>
</div>

<script>
 /************* Supabase klient (pokud používáš vlastní supabase.js, uprav to) *************/
 const supabaseUrl = 'https://hurayrwshmsvsylhwlbj.supabase.co';
 const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1cmF5cndzaG1zdnN5bGh3bGJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyMTk4MzEsImV4cCI6MjA3OTc5NTgzMX0.Q0KpZX_Dln9_9OwZcCty-bbyw8drX84ax098Uy03VUI';

 let supabaseClient = null;
 if (window.supabase && supabase.createClient) {
   const { createClient } = supabase;
   supabaseClient = createClient(supabaseUrl, supabaseAnonKey);
 }

 /************* LEVÉ GRAFY – AYAS-7 vrstvy *************/
 const layerCharts = [];

 function createLayerChart(canvasId) {
   const ctx = document.getElementById(canvasId).getContext('2d');
   const dataPoints = Array.from({length: 6}, () => 4 + Math.random() * 3); // 4–7 %
   const chart = new Chart(ctx, {
     type: 'line',
     data: {
       labels: ['T1','T2','T3','T4','T5','T6'],
       datasets: [{
         data: dataPoints,
         borderColor: '#1da84f',
         backgroundColor: 'rgba(29,168,79,0.08)',
         tension: 0.35,
         fill: true,
         pointRadius: 2,
         pointBackgroundColor: '#1da84f'
       }]
     },
     options: {
       responsive: true,
       maintainAspectRatio: false,
       plugins: { legend: { display: false } },
       scales: {
         x: {
           grid: { color: 'rgba(0,0,0,0.05)' },
           ticks: { font: { size: 11 } }
         },
         y: {
           beginAtZero: false,
           grid: { color: 'rgba(0,0,0,0.05)' },
           ticks: { font: { size: 11 }, callback: v => v + '%' }
         }
       }
     }
   });
   return chart;
 }

 for (let i = 1; i <= 7; i++) {
   layerCharts.push(createLayerChart('layerChart-' + i));
 }

 // lehké "dýchání" grafů – občasná aktualizace dat
 setInterval(() => {
   layerCharts.forEach(chart => {
     const ds = chart.data.datasets[0].data;
     for (let i = 0; i < ds.length; i++) {
       ds[i] = ds[i] + (Math.random() - 0.5) * 0.2; // drobná odchylka
     }
     chart.update('none');
   });
 }, 8000);

 /************* BOX 1 – Přidání člena a WW-KEY *************/
 const memberForm = document.getElementById('memberForm');
 const memberResult = document.getElementById('memberResult');
 const spanWWKey = document.getElementById('wwKeyCount');
 const spanWWUsdt = document.getElementById('wwUsdtAmount');

 let dailyNewMembers = 0;
 let dailyTotalDeposit = 0;
 let dailyTotalWWKey = 0;

 memberForm.addEventListener('submit', async (e) => {
   e.preventDefault();
   const name = document.getElementById('memberName').value.trim();
   const email = document.getElementById('memberEmail').value.trim();
   const phone = document.getElementById('memberPhone').value.trim();
   const amountCZK = parseFloat(document.getElementById('investmentAmount').value);

   if (!name || !email || !phone || isNaN(amountCZK)) return;

   // Přepočet: 1 WW-KEY = 25 CZK (příklad)
   const wwKeyCount = Math.floor(amountCZK / 25);
   const usdtAmount = (amountCZK / 25).toFixed(2);

   spanWWKey.textContent = wwKeyCount.toString();
   spanWWUsdt.textContent = usdtAmount + ' USDT';
   memberResult.style.display = 'block';

   // Update denního reportu (lokálně)
   dailyNewMembers += 1;
   dailyTotalDeposit += amountCZK;
   dailyTotalWWKey += wwKeyCount;
   updateDailyReport();

   // Zápis do Supabase (pokud je klient k dispozici)
   if (supabaseClient) {
     try {
       const { error } = await supabaseClient
         .from('members_data')
         .insert([
           {
             name,
             email,
             phone,
             deposit: amountCZK,
             paid: true,
             ww_key: wwKeyCount
           }
         ]);
       if (error) {
         console.error('Supabase error:', error);
       }
     } catch (err) {
       console.error('Supabase insert exception:', err);
     }
   }

   memberForm.reset();
 });

 /************* BOX 2 – Podmínky (modal) *************/
 const btnShowTerms = document.getElementById('btnShowTerms');
 const chkAgreeTerms = document.getElementById('chkAgreeTerms');
 const termsBackdrop = document.getElementById('termsModalBackdrop');
 const btnCloseTerms = document.getElementById('btnCloseTerms');

 btnShowTerms.addEventListener('click', () => {
   termsBackdrop.style.display = 'flex';
 });

 btnCloseTerms.addEventListener('click', () => {
   termsBackdrop.style.display = 'none';
 });

 termsBackdrop.addEventListener('click', (e) => {
   if (e.target === termsBackdrop) {
     termsBackdrop.style.display = 'none';
   }
 });

 /************* BOX 4 – Živé kurzy USDT a BNB *************/
 async function fetchRates() {
   try {
     const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether,binancecoin&vs_currencies=usd');
     const data = await res.json();
     const usdt = data.tether?.usd;
     const bnb = data.binancecoin?.usd;
     document.getElementById('rate-usdt').textContent = usdt ? '$' + usdt.toFixed(4) : 'N/A';
     document.getElementById('rate-bnb').textContent = bnb ? '$' + bnb.toFixed(2) : 'N/A';
   } catch (err) {
     console.error('Rates error:', err);
     document.getElementById('rate-usdt').textContent = 'Chyba';
     document.getElementById('rate-bnb').textContent = 'Chyba';
   }
 }

 fetchRates();
 setInterval(fetchRates, 10000);

 /************* BOX 5 – Výnos družstva (sloupcový graf) *************/
 const coopCtx = document.getElementById('coopYieldChart').getContext('2d');
 const coopYieldChart = new Chart(coopCtx, {
   type: 'bar',
   data: {
     labels: ['L1','L2','L3','L4','L5','L6','L7'],
     datasets: [{
       data: [4.5,4.8,5.2,4.1,4.9,5.4,5.8],
       backgroundColor: [
         '#1da84f','#e11d48','#7c3aed','#facc15','#f97316','#6b7280','#0ea5e9'
       ]
     }]
   },
   options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: { legend: { display: false } },
     scales: {
       x: {
         grid: { display: false },
         ticks: { font: { size: 11 } }
       },
       y: {
         beginAtZero: true,
         grid: { color: 'rgba(0,0,0,0.05)' },
         ticks: {
           font: { size: 11 },
           callback: v => v + '%'
         }
       }
     }
   }
 });

 /************* BOX 6 – Denní report (lokální simulace) *************/
 function updateDailyReport() {
   document.getElementById('report-newMembers').textContent = dailyNewMembers.toString();
   document.getElementById('report-totalDeposit').textContent = dailyTotalDeposit.toFixed(0) + ' CZK';
   document.getElementById('report-totalWWKey').textContent = dailyTotalWWKey.toString();
 }
</script>

</body>
</html>
