<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>ƒålensk√° karta ‚Äì intern√≠ v√Ωjezd</title>

<style>
/* ======================================================
   PDF ‚Äì MEMBER INTELLIGENCE CARD
====================================================== */
@page{
  size:A4;
  margin:22mm 18mm;
}

body{
  font-family:"Segoe UI",Tahoma,Verdana,sans-serif;
  background:#ffffff;
  color:#111827;
  font-size:12px;
}

h1,h2,h3{
  margin:0;
  font-weight:600;
}

hr{
  border:none;
  border-top:1px solid #d1d5db;
  margin:18px 0;
}

/* ======================================================
   HLAVIƒåKA
====================================================== */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-size:18px;
  font-weight:700;
  letter-spacing:.08em;
}

.logo span{
  color:#b45309;
}

.doc-title{
  text-align:right;
}

.doc-title h1{
  font-size:16px;
}

.doc-title p{
  font-size:10px;
  color:#6b7280;
}

/* ======================================================
   INFO BOX
====================================================== */
.info-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}

.box{
  border:1px solid #e5e7eb;
  border-radius:8px;
  padding:10px 12px;
}

.box h3{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.12em;
  color:#6b7280;
  margin-bottom:6px;
}

.value{
  font-size:13px;
  font-weight:600;
}

/* ======================================================
   TABULKY
====================================================== */
table{
  width:100%;
  border-collapse:collapse;
  font-size:11px;
}

th,td{
  padding:8px 6px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
}

th{
  color:#6b7280;
  font-weight:600;
}

/* ======================================================
   FOOTER
====================================================== */
.footer{
  margin-top:28px;
  font-size:9px;
  color:#6b7280;
}

.audit{
  margin-top:10px;
  font-family:monospace;
  font-size:9px;
  word-break:break-all;
}

/* ======================================================
   PRINT FIX ‚Äì Z√ÅKAZ L√ÅM√ÅN√ç BLOK≈Æ
====================================================== */
@media print {

  /* nikdy nel√°mej boxy */
  .box,
  table,
  tr {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* hlaviƒçky nikdy na konci str√°nky */
  h1, h2, h3 {
    page-break-after: avoid;
    break-after: avoid;
  }

  /* oddƒõlovaƒçe nepou≈æ√≠vej jako m√≠sto zlomu */
  hr {
    page-break-before: avoid;
    page-break-after: avoid;
  }

}

</style>
</head>

<body>

<!-- ======================================================
     HLAVIƒåKA
====================================================== -->
<div class="header">
  <div class="logo">
    AYAS-7 <span>WIN.WIN</span>
  </div>

  <div class="doc-title">
    <h1>ƒålensk√° karta ‚Äì intern√≠ v√Ωjezd</h1>
    <p>Member Intelligence Card</p>
  </div>
</div>

<hr>

<!-- ======================================================
     IDENTIFIKACE DOKUMENTU
====================================================== -->
<div class="info-grid">
  <div class="box">
    <h3>Dokument</h3>
    <div class="value">Intern√≠ v√Ωstup syst√©mu</div>
  </div>

  <div class="box">
    <h3>Datum generov√°n√≠</h3>
    <div class="value"><span id="pdf-generated">‚Äî</span></div>
  </div>
</div>

<hr>

<!-- ======================================================
     IDENTITA ƒåLENA
====================================================== -->
<div class="box">
  <h3>Identita ƒçlena</h3>

  <div class="info-grid">
    <div>
      Jm√©no:<br>
      <b><span id="pdf-name">‚Äî</span></b>
    </div>
    <div>
      Email:<br>
      <b><span id="pdf-email">‚Äî</span></b>
    </div>
    <div>
      ID ƒçlena:<br>
      <b><span id="pdf-id">‚Äî</span></b>
    </div>
    <div>
      Stav ƒçlenstv√≠:<br>
      <b><span id="pdf-status">‚Äî</span></b>
    </div>
  </div>
</div>


<hr>

<!-- ======================================================
     ANGA≈ΩOVANOST & ROLE
====================================================== -->
<div class="box">
  <h3>Anga≈æovanost a role</h3>

  <table>
    <tr>
      <th>Aktu√°ln√≠ role</th>
      <td>T1 ‚Äì Trader 1</td>
    </tr>
    <tr>
      <th>Max. matching dle r√°mce</th>
      <td>21 %</td>
    </tr>
    <tr>
      <th>Schv√°len√Ω matching</th>
      <td>18 %</td>
    </tr>
    <tr>
      <th>WW-KEY</th>
      <td>3 420</td>
    </tr>
  </table>
</div>

<hr>

<hr>

<hr>

<!-- ======================================================
     WW-KEY & CERTIFIK√ÅTY
====================================================== -->
<div class="box">
  <h3>WW-KEY & certifik√°ty</h3>

  <div style="margin-bottom:10px">
    <b>WW-KEY (celkem):</b>
    <span id="pdf-wwkey-total">‚Äî</span>
  </div>

  <table>
    <thead>
      <tr>
        <th>Certifik√°t</th>
        <th>Hodnota WW-KEY</th>
        <th>Stav</th>
        <th>Platnost</th>
      </tr>
    </thead>
    <tbody id="pdf-certificates">
      <tr>
        <td colspan="4" style="text-align:center;color:#6b7280">
          ≈Ω√°dn√© certifik√°ty nenalezeny
        </td>
      </tr>
    </tbody>
  </table>

  <p style="font-size:10px;color:#6b7280;margin-top:8px">
    WW-KEY je souƒçtem schv√°len√Ωch certifik√°t≈Ø.
    Uveden√© hodnoty p≈ôedstavuj√≠ auditn√≠ snapshot ke dni generov√°n√≠ dokumentu.
  </p>
</div>


<!-- ======================================================
     BENEFITY ƒåLENA
====================================================== -->
<div class="box">
  <h3>ƒålensk√© benefity</h3>

  <table>
    <thead>
      <tr>
        <th>N√°zev benefitu</th>
        <th>Obdob√≠</th>
        <th>Stav</th>
        <th>Pozn√°mka</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>V√Ωkonnostn√≠ bonus</td>
        <td>12 / 2025</td>
        <td>Schv√°len</td>
        <td>Rozhodnut√≠ v√Ωboru SPF</td>
      </tr>
      <tr>
        <td>Partnersk√Ω benefit</td>
        <td>01 / 2026</td>
        <td>ƒåek√° na schv√°len√≠</td>
        <td>‚Äî</td>
      </tr>
    </tbody>
  </table>

  <p style="font-size:10px;color:#6b7280;margin-top:8px">
    Uveden√© benefity nejsou n√°rokov√©. P≈ôidƒõlen√≠ podl√©h√° rozhodnut√≠
    org√°n≈Ø dru≈æstva a m≈Ø≈æe b√Ωt kdykoliv zmƒõnƒõno nebo odebr√°no.
  </p>
</div>


<!-- ======================================================
     SPF
====================================================== -->
<div class="box">
  <h3>SPF & rozhodnut√≠ dru≈æstva</h3>

  <table>
    <tr>
      <th>√öƒçast ve SPF</th>
      <td>Ano</td>
    </tr>
    <tr>
      <th>Posledn√≠ obdob√≠</th>
      <td>12 / 2025</td>
    </tr>
    <tr>
      <th>Rozhodnut√≠</th>
      <td>Schv√°leno</td>
    </tr>
  </table>
</div>

<hr>

<!-- ======================================================
     KARI√âRN√ç R√ÅMEC (READ-ONLY)
====================================================== -->
<div class="no-break">
  <div class="box">
    <h3>Kari√©rn√≠ r√°mec</h3>
  <p style="font-size:10px;color:#6b7280">
    Uveden√© hodnoty p≈ôedstavuj√≠ maxim√°ln√≠ odpovƒõdnostn√≠ r√°mec.
    P≈ôidƒõlen√≠ role nen√≠ n√°rokov√©.
  </p>
</div>

<hr>

<!-- ======================================================
     AUDIT
====================================================== -->
<div class="footer">
  <b>Auditn√≠ informace</b><br>
  Tento dokument byl vygenerov√°n syst√©mem AYAS-7 jako
  snapshot intern√≠ho stavu ƒçlena.
  Nejedn√° se o nab√≠dku, investiƒçn√≠ doporuƒçen√≠ ani pr√°vn√≠ n√°rok.

  <div class="audit">
    Audit ID: AYAS7-MIC-20260115-143200<br>
    Hash: 9bcbd59c6d9f42fcbb7aea17de2ba98092c1b1d9cdab94a1d8eb4a8650809f5f
  </div>
</div>

<script type="module">
import { createClient } from
  "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

/* =========================================
   SUPABASE CLIENT (PDF)
========================================= */
const supabase = createClient(
  "https://azfrniqqtetoqploxwgq.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6ZnJuaXFxdGV0b3FwbG94d2dxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MzQ1OTYsImV4cCI6MjA4MzMxMDU5Nn0.QchmzNhs8owd6pkjZCk04u6PJoJ2Bhzz7oGV0KFyqdU"
);

/* üîë zp≈ô√≠stupn√≠me klienta i pro dal≈°√≠ script */
window.supabase = supabase;

/* =========================================
   PARAMETR Z URL
========================================= */
const params = new URLSearchParams(window.location.search);
const email = params.get("email");

if (!email) {
  document.body.innerHTML =
    "<p>Chyb√≠ identifikace ƒçlena.</p>";
} else {

  /* =========================================
     NAƒåTEN√ç ƒåLENA
  ========================================= */
  const { data, error } = await supabase
    .from("members_data")
    .select("*")
    .eq("email", email)
    .single();

  if (error || !data) {
    document.body.innerHTML =
      "<p>ƒålen nebyl nalezen.</p>";
  } else {

    /* ===== IDENTITA ===== */
    document.getElementById("pdf-name").textContent =
      data.full_name || data.name || "‚Äî";

    document.getElementById("pdf-email").textContent =
      data.email;

    document.getElementById("pdf-id").textContent =
      data.id;

    document.getElementById("pdf-status").textContent =
      data.status || "‚Äî";

    const gen = document.getElementById("pdf-generated");
    if (gen) {
      gen.textContent =
        new Date().toLocaleString("cs-CZ");
    }

    /* =========================================
       ‚¨áÔ∏è KL√çƒåOV√ù ≈ò√ÅDEK ‚Äì CERTIFIK√ÅTY & WW-KEY
    ========================================= */
    loadCertificates(data.id);
  }
}
</script>


<script>
async function loadCertificates(memberId) {

  const { data, error } = await window.supabase
    .from("member_certificates")
    .select("certificate_name, ww_key_value, status, valid_from")
    .eq("member_id", memberId)
    .eq("status", "approved");

  const tableBody = document.getElementById("pdf-certificates");
  const totalSpan = document.getElementById("pdf-wwkey-total");

  if (error || !data || data.length === 0) {
    totalSpan.textContent = "0";
    return;
  }

  let total = 0;
  tableBody.innerHTML = "";

  data.forEach(cert => {
    total += Number(cert.ww_key_value || 0);

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${cert.certificate_name}</td>
      <td>${cert.ww_key_value}</td>
      <td>${cert.status}</td>
      <td>${cert.valid_from
        ? new Date(cert.valid_from).toLocaleDateString("cs-CZ")
        : "‚Äî"}
      </td>
    `;
    tableBody.appendChild(tr);
  });

  totalSpan.textContent = total.toLocaleString("cs-CZ");
}
</script>

</body>
</html>
