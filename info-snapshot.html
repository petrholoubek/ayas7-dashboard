<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<title>AYAS-7 · Truth Snapshot</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<!-- PWA -->
<link rel="manifest" href="/manifest.json">
<link rel="icon" sizes="192x192" href="/ayas7-192.png">
<link rel="icon" sizes="512x512" href="/ayas7-512.png">
<link rel="apple-touch-icon" href="/ayas7-192.png">
<meta name="theme-color" content="#020617">

<style>
:root{
  --bg:#020617;
  --border:#94a3b833;
  --blue:#38bdf8;
  --text:#e5e7eb;
  --muted:#9ca3af;
}

html,body{
  margin:0;
  padding:0;
  min-height:100%;
  background:
    radial-gradient(circle at 30% -10%, #0f172a 0%, transparent 45%),
    radial-gradient(circle at 80% 20%, #02081a 0%, transparent 50%),
    radial-gradient(circle at 50% 120%, #020617 0%, #000 65%);
  font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  color:var(--text);
}

/* HERO */
.ayas-hero{
  height:52vh;
  min-height:420px;
  overflow:hidden;
  position:relative;
}
.ayas-hero img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.ayas-hero::after{
  content:"";
  position:absolute;
  bottom:0;left:0;right:0;
  height:120px;
  background:linear-gradient(to bottom, rgba(2,6,23,0), #020617);
}

/* MAIN */
main{
  max-width:1200px;
  margin:-80px auto 140px;
  padding:0 18px;
  position:relative;
  z-index:2;
}

/* UNIVERSAL BOX */
.ayas-box{
  background:linear-gradient(180deg, rgba(15,23,42,.88), rgba(2,6,23,.96));
  border:1px solid rgba(148,163,184,.25);
  border-radius:18px;
  padding:22px 24px 26px;
  margin-bottom:24px;
}
.ayas-box-title{
  font-size:12px;
  letter-spacing:.18em;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:14px;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:22px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr;}
}

/* METRICS */
.metric{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  margin-bottom:6px;
}
.metric span:first-child{color:var(--muted)}
.value{font-weight:800;font-variant-numeric:tabular-nums}

/* HEALTH BAR */
.health-bar-wrap{padding:10px 0}
.health-bar-label{
  display:flex;
  justify-content:space-between;
  margin-bottom:12px;
  font-size:12px;
  letter-spacing:.12em;
  text-transform:uppercase;
  color:var(--muted);
}
.health-bar-bg{
  width:100%;
  height:14px;
  background:rgba(255,255,255,.06);
  border-radius:10px;
  overflow:hidden;
}
.health-bar-fill{
  height:100%;
  width:0%;
  border-radius:10px;
  transition:width 1.2s ease;
}

/* FOOTER */
footer{
  margin-top:64px;
  padding-top:14px;
  border-top:1px solid var(--border);
  font-size:11px;
  letter-spacing:.16em;
  text-transform:uppercase;
  color:#64748b;
  text-align:center;
}
</style>
</head>

<body>

<header class="ayas-hero">
  <img src="/ayas7-hero.jpg" alt="AYAS-7 System Engine">
</header>

<main>

<section class="ayas-box">
  <div class="ayas-box-title">System · Truth Snapshot</div>
  <div class="metric"><span>Mode</span><span id="sysMode" class="value">—</span></div>
  <div class="metric"><span>Health</span><span id="sysHealth" class="value">—</span></div>
  <div class="metric"><span>Uptime</span><span id="sysUptime" class="value">—</span></div>
  <div class="metric"><span>Snapshot</span><span id="snapTime" class="value">—</span></div>
</section>

<section class="ayas-box">
  <div class="ayas-box-title">Operational Status</div>
  <div class="health-bar-wrap">
    <div class="health-bar-label">
      <span>Status</span>
      <span><span id="healthValue">—</span> <span id="healthState"></span></span>
    </div>
    <div class="health-bar-bg">
      <div class="health-bar-fill" id="healthBar"></div>
    </div>
  </div>
</section>

<div class="grid">
  <section class="ayas-box">
    <div class="ayas-box-title">Liquidity</div>
    <div class="metric"><span>TVL</span><span id="liqTVL" class="value">—</span></div>
    <div class="metric"><span>Utilization</span><span id="liqUtil" class="value">—</span></div>
    <div class="metric"><span>Depth</span><span id="liqDepth" class="value">—</span></div>
    <div class="metric"><span>Slippage</span><span id="liqSlip" class="value">—</span></div>
  </section>

  <section class="ayas-box">
    <div class="ayas-box-title">Tokens</div>
    <div class="metric"><span>WW-UNIT</span><span id="unitSupply" class="value">—</span></div>
    <div class="metric"><span>WW-RESERVE</span><span id="reserveSupply" class="value">—</span></div>
    <div class="metric"><span>WW-KEY</span><span id="keySupply" class="value">—</span></div>
  </section>
</div>

<section class="ayas-box">
  <div class="ayas-box-title">Audit & Certification</div>
  <ul style="padding-left:18px;color:#9ca3af">
    <li>System Integrity Verification</li>
    <li>Liquidity & Accounting Audit</li>
    <li>Multisig & Governance Validation</li>
  </ul>
</section>

<footer>
  AYAS-7 · Truth Snapshot · Read Only
</footer>

</main>
<script>
(async function () {

 const SNAPSHOT_URL = "https://snapshot.ayas7.com/api/snapshot";
 const CACHE_KEY = "AYAS_SNAPSHOT_CACHE";

  
function updateHealthBar(v){
  if(v == null || isNaN(v)) return;

  const val = Math.max(0, Math.min(100, Number(v)));
  const bar = document.getElementById("healthBar");
  const txt = document.getElementById("healthValue");

  if(!bar || !txt) return;

  bar.style.width = val + "%";
  txt.textContent = val.toFixed(1) + " %";

  // barva podle stavu
  if(val >= 70){
    bar.style.background = "linear-gradient(90deg,#22c55e,#4ade80)";
    bar.style.boxShadow = "0 0 14px rgba(34,197,94,.45)";
  }else if(val >= 40){
    bar.style.background = "linear-gradient(90deg,#facc15,#fde047)";
    bar.style.boxShadow = "0 0 14px rgba(250,204,21,.35)";
  }else{
    bar.style.background = "linear-gradient(90deg,#ef4444,#f87171)";
    bar.style.boxShadow = "0 0 14px rgba(239,68,68,.45)";
  }
}


  async function loadSnapshot() {
    try {
      const res = await fetch(SNAPSHOT_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("API error");

      const data = await res.json();
      localStorage.setItem(CACHE_KEY, JSON.stringify(data));
      render(data);
      updateNet(true);

    } catch (err) {
      const cached = localStorage.getItem(CACHE_KEY);
      if (cached) {
        render(JSON.parse(cached));
        updateNet(false);
      } else {
        renderError();
        updateNet(false);
      }
    }
  }

  function render(s) {
    /* SYSTEM */
    set("sysMode",   s.meta?.mode ?? "—");
    set("sysHealth", formatPct(s.meta?.health));
    updateHealthBar(s.meta?.health);
    set("healthState", healthStateLabel(s.meta?.health, true));

    set("sysUptime", s.meta?.uptime ?? "—");
    set("snapTime",  formatTime(s.meta?.generatedAt));

    /* LIQUIDITY */
    set("liqTVL",  formatUSD(s.pools?.liquidityUSD));
    set("liqUtil", formatPct(s.pools?.utilization));
    set("liqDepth", s.pools?.depth ?? "—");
    set("liqSlip", formatPct(s.pools?.slippage));

    /* TOKENS */
    set("unitSupply",     formatNum(s.tokens?.WW_UNIT?.supply));
    set("reserveSupply",  formatUSD(s.tokens?.WW_RESERVE?.balance));
    set("keySupply",      formatNum(s.tokens?.WW_KEY?.holders));
  }

  function renderError() {
    set("healthState", "OFFLINE");

    set("sysMode", "offline");
    set("sysHealth", "—");
    set("snapTime", "—");
  }
function healthStateLabel(v, online){
  if(!online) return "OFFLINE";
  if(v >= 75) return "STABLE";
  if(v >= 40) return "ACTIVE";
  return "LIMITED";
}


  /* ===== HELPERS ===== */

  function set(id, val) {
    const el = document.getElementById(id);
    if (el) el.textContent = val ?? "—";
  }

  function formatUSD(v) {
    if (v == null) return "—";
    return "$" + Number(v).toLocaleString("en-US", { maximumFractionDigits: 2 });
  }

  function formatNum(v) {
    if (v == null) return "—";
    return Number(v).toLocaleString("en-US");
  }

  function formatPct(v) {
    if (v == null) return "—";
    return Number(v).toFixed(2) + " %";
  }
function snapshotAge(ts){
  if(!ts) return "—";

  const diff = Math.floor((Date.now() - new Date(ts).getTime()) / 1000);

  if(diff < 60) return diff + " s ago";
  if(diff < 3600) return Math.floor(diff/60) + " min ago";
  return Math.floor(diff/3600) + " h ago";
}


  // ✅ SPRÁVNÝ ČAS – STEJNÝ NA PC I iPHONU
  function formatTime(t) {
    if (!t) return "—";
    return new Date(t).toLocaleString("cs-CZ", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    });
  }

  // ✅ ONLINE / OFFLINE → HERO LED
  function updateNet(online) {
    const dot = document.querySelector(".hero-dot");
    if (!dot) return;

    dot.style.background = online ? "#22c55e" : "#ef4444";
    dot.style.boxShadow = online
      ? "0 0 10px #22c55e"
      : "0 0 10px #ef4444";
  }
function updateNet(online) {
  const heroDot = document.querySelector(".hero-dot");
  const sectionDot = document.getElementById("sectionLed");

  if (heroDot) {
    heroDot.style.background = online ? "#22c55e" : "#ef4444";
    heroDot.style.boxShadow = online
      ? "0 0 10px #22c55e"
      : "0 0 10px #ef4444";
  }

  if (sectionDot) {
    sectionDot.classList.toggle("live", online);
  }
}


  loadSnapshot();
  setInterval(loadSnapshot, 30000); // klidný refresh

})();
</script>

</body>
</html>
