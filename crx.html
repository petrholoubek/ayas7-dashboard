<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<title>AYAS-7 · Member Bank Account</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --bg:#020617;
  --panel:#0b1222;
  --border:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;

  --accent:#22c55e;   /* bankovní zelená */
  --accent-soft:rgba(34,197,94,0.15);
}

*{box-sizing:border-box}

html,body{
  margin:0;
  padding:0;
  min-height:100%;
  background:radial-gradient(1200px 600px at 50% -10%, #0b1220, #020617);
  font-family:"Segoe UI", Tahoma, Verdana, sans-serif;
  color:var(--text);
}

main{
  max-width:880px;
  margin:48px auto 120px;
  padding:0 18px;
}

/* ================= HEADER ================= */
.header{margin-bottom:32px}

.kicker{
  display:flex;align-items:center;gap:8px;
  font-size:11px;letter-spacing:.18em;
  text-transform:uppercase;color:var(--muted);
}

.dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--accent);
  box-shadow:0 0 10px var(--accent);
}

.title{margin-top:10px;font-size:26px;font-weight:700}
.subtitle{margin-top:4px;font-size:13px;color:var(--muted)}

/* ================= CARD BASE ================= */
.card{
  background:linear-gradient(180deg, rgba(15,23,42,.92), rgba(2,6,23,.96));
  border:1px solid var(--border);
  border-radius:18px;
  padding:22px 24px 26px;
  margin-top:18px;
}

/* ================= BANK BALANCE ================= */
.balance{
  font-size:54px;
  font-weight:800;
  letter-spacing:.02em;
  margin:6px 0 8px;
}

.meta{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  color:var(--muted);
}

/* ================= GRAPH ================= */
.graph{
  height:160px;
  margin-top:16px;
  border-top:1px solid rgba(148,163,184,.15);
  padding-top:12px;
}

canvas{width:100%;height:100%}

/* ================= INFO TABLE ================= */
.row{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  padding:8px 0;
  border-bottom:1px dashed rgba(255,255,255,.06);
}

/* ================= MANUAL LOAD ================= */
.manual{
  display:flex;
  gap:10px;
}

.manual input{
  flex:1;
  padding:10px;
  background:#020617;
  border:1px solid var(--border);
  color:var(--text);
  border-radius:10px;
}

button{
  background:var(--accent);
  color:#000;
  border:none;
  padding:10px 16px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}

footer{
  margin-top:42px;
  font-size:11px;
  letter-spacing:.16em;
  text-transform:uppercase;
  color:#64748b;
}
</style>
</head>

<body>

<main>

<!-- HEADER -->
<section class="header">
  <div class="kicker"><span class="dot"></span>Member Account · Secure View</div>
  <div class="title">AYAS-7 · Osobní účet</div>
  <div id="memberName" class="subtitle">Načítám data člena…</div>
</section>

<!-- MANUAL LOAD (ADMIN / TEST) -->
<section class="card">
  <div class="manual">
    <input id="manualInput" placeholder="Zadej e-mail nebo UUID člena" />
    <button onclick="loadManual()">Načíst</button>
  </div>
</section>

<!-- MAIN BALANCE -->
<section class="card">
  <div id="crxTotal" class="balance">—</div>

  <div class="meta">
    <span>WW‑KEY: <b id="wwkeyTotal">—</b></span>
    <span>Podíl: <b id="yieldPct">—</b></span>
  </div>

  <div class="graph">
    <canvas id="chart"></canvas>
  </div>
</section>

<!-- ACCOUNT INFO -->
<section class="card">
  <div class="row"><span>Status účtu</span><span id="status">—</span></div>
  <div class="row"><span>Poslední snapshot</span><span id="snapshot">—</span></div>
  <div class="row"><span>Member ID</span><span id="memberId">—</span></div>
</section>

<footer>AYAS‑7 · Digital Cooperative Banking</footer>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://azfrniqqtetoqploxwgq.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6ZnJuaXFxdGV0b3FwbG94d2dxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MzQ1OTYsImV4cCI6MjA4MzMxMDU5Nn0.QchmzNhs8owd6pkjZCk04u6PJoJ2Bhzz7oGV0KFyqdU";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function renderMember(d){
  memberName.innerText = d.full_name;
  crxTotal.innerText = d.crx_total + " CRX";
  wwkeyTotal.innerText = d.wwkey_total;
  yieldPct.innerText = d.yield_percent + " %";
  status.innerText = d.status;
  snapshot.innerText = new Date(d.last_snapshot_at).toLocaleString("cs-CZ");
  memberId.innerText = d.member_uuid;
  renderChart(d.crx_history || []);
}

async function loadManual(){
  const val = manualInput.value.trim();
  if(!val) return;

  let q = sb.from("v_member_account").select("*");
  q = val.includes("@") ? q.eq("email", val) : q.eq("member_uuid", val);

  const { data, error } = await q.single();
  if(error){ alert("Člen nenalezen nebo RLS blokuje přístup"); return; }

  renderMember(data);
}

function renderChart(history){
  new Chart(chart,{type:"line",data:{labels:history.map((_,i)=>i),datasets:[{data:history,tension:.4,borderWidth:2,pointRadius:0}]},options:{plugins:{legend:{display:false}},scales:{x:{display:false},y:{ticks:{color:"#94a3b8"}}}}});
}
</script>

</body>
</html>
