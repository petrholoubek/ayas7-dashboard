<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>AYAS-7 · Evidence obchodníků</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:"Segoe UI",Tahoma,Verdana,sans-serif;
  color:#0f172a;
  margin:40px;
}

h1{
  font-size:22px;
  margin-bottom:6px;
}

h2{
  font-size:16px;
  margin:20px 0 10px;
}

p{
  font-size:12px;
  line-height:1.5;
  color:#334155;
}

hr{
  margin:22px 0;
  border:none;
  border-top:1px solid #cbd5e1;
}

.box{
  border:1px solid #cbd5e1;
  border-radius:10px;
  padding:16px 18px;
  margin-bottom:18px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}

th, td{
  padding:8px 10px;
  border-bottom:1px solid #e5e7eb;
}

th{
  text-align:left;
  background:#f1f5f9;
  font-weight:600;
}

@media print{
  .box, table, tr{
    page-break-inside:avoid;
    break-inside:avoid;
  }
  h1,h2{
    page-break-after:avoid;
  }
}
</style>
</head>

<body>

<!-- ======================================================
     HLAVIČKA
====================================================== -->
<h1>AYAS-7 · Evidence obchodníků</h1>
<p>
Interní auditní výstup – kariérní a odpovědnostní role<br>
Generováno: <b id="generated-date">—</b>
</p>

<hr>

<!-- ======================================================
     KONTEXT
====================================================== -->
<div class="box">
  <p>
    Tento dokument slouží jako <b>interní evidence obchodníků</b>
    a jejich kariérních rolí v systému WIN.WIN / AYAS-7.
    Uvedené role představují <b>odpovědnostní rámec</b>
    a nejsou nárokové.
  </p>
</div>

<!-- ======================================================
     TABULKA OBCHODNÍKŮ
====================================================== -->
<div class="box">
  <h2>Přehled obchodníků</h2>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Jméno</th>
        <th>Email</th>
        <th>Kariérní role</th>
        <th>Datum zařazení</th>
      </tr>
    </thead>
    <tbody id="pdf-agents-body">
      <tr>
        <td colspan="5">Načítám data…</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ======================================================
     POZNÁMKA
====================================================== -->
<div class="box">
  <p style="font-size:11px;color:#475569">
    Kariérní role představují maximální rámec odpovědnosti
    v systému. Nezakládají automatický ani nárokový nárok
    na provize či jiné plnění.
  </p>
</div>

<hr>

<p style="font-size:10px;color:#64748b;text-align:center">
AYAS-7 · interní audit-ready výstup<br>
WIN.WIN družstvo
</p>

<!-- ======================================================
     DATA & LOGIKA
====================================================== -->
<script type="module">
import { createClient } from
  "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://azfrniqqtetoqploxwgq.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6ZnJuaXFxdGV0b3FwbG94d2dxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MzQ1OTYsImV4cCI6MjA4MzMxMDU5Nn0.QchmzNhs8owd6pkjZCk04u6PJoJ2Bhzz7oGV0KFyqdU"
);

document.getElementById("generated-date").textContent =
  new Date().toLocaleString("cs-CZ");

async function loadAgentsCareerPdf() {

  const tbody = document.getElementById("pdf-agents-body");

  const { data, error } = await supabase
    .from("member_career")
    .select(`
      assigned_at,
      members_data (
        full_name,
        email
      ),
      career_roles (
        code,
        name
      )
    `)
    .eq("status", "active");

  if (error || !data || data.length === 0) {
    tbody.innerHTML =
      `<tr><td colspan="5">Žádní obchodníci nejsou evidováni.</td></tr>`;
    return;
  }

  tbody.innerHTML = "";

  data.forEach((row, index) => {

    const name = row.members_data?.full_name ?? "—";
    const email = row.members_data?.email ?? "—";
    const role = row.career_roles
      ? `${row.career_roles.code} – ${row.career_roles.name}`
      : "—";

    const date = row.assigned_at
      ? new Date(row.assigned_at).toLocaleDateString("cs-CZ")
      : "—";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${name}</td>
      <td>${email}</td>
      <td>${role}</td>
      <td>${date}</td>
    `;

    tbody.appendChild(tr);
  });
}

loadAgentsCareerPdf();
</script>

</body>
</html>
